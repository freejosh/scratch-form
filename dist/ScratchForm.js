(function(g,f){if(typeof exports=="object"&&typeof module<"u"){module.exports=f()}else if("function"==typeof define && define.amd){define("ScratchForm",f)}else {g["ScratchForm"]=f()}}(typeof globalThis < "u" ? globalThis : typeof self < "u" ? self : this,function(){var exports={};var __exports=exports;var module={exports};
function b(e){let{type:t,value:r}=e;return t==="checkbox"||t==="radio"?e.checked?r:void 0:t==="number"||t==="range"?parseFloat(r):t==="file"?e.files.length?e.files:null:r}function P(e,t){if(e.type==="checkbox"||e.type==="radio"){e.checked=!!t;return}e.value=t}function N(e,t){e.hasAttribute("name")&&t.push(e),t.splice(t.length,0,...e.querySelectorAll("[name]"))}function $(e){let t={};return e.querySelectorAll('[name$="[]"]').forEach(r=>{let n=t[r.name];n||(n=[],t[r.name]=n),n.push(r)}),t}function v(e,t){let r=t[e.name].findIndex(n=>n===e);return r===-1&&console.error(`Could not find index for node: ${e.outerHTML}`),r}function p(e){let t=e,r=[],n=e.indexOf("[");return n!==-1&&(t=e.slice(0,n),r=e.slice(n+1,-1).split("][")),r.unshift(t),r}function x(e){let[t,...r]=e;return r.length?`${t}[${r.join("][")}]`:t}function y(e,t,r,n=!1){let[o,...f]=p(t);if(f.length>0){e[o]||(/^[0-9]+$/.test(f[0])?e[o]=[]:e[o]={}),y(e[o],x(f),r,n);return}if(n){if(Array.isArray(e)){e.splice(o,1);return}delete e[o];return}e[o]=r}function A(e,t){let[r,...n]=p(t);return n.length>0?e[r]?A(e[r],x(n)):void 0:e[r]}function C(e,t){let[r,...n]=p(t);return n.length>0?e[r]?C(e[r],x(n)):!1:r in e}var O="_sf_";function F(e,t={}){let{onChange:r,event:n="input"}=t,o={},f={set(i,a,l){let c=a,s=l,u;return a.startsWith(O)?(c=a.slice(O.length),{value:s,node:u}=l):(u=e.querySelector(`[name="${c}"]`),u&&P(u,l)),y(i,c,s),r(c,s,u,i),!0},deleteProperty(i,a){return y(i,a,void 0,!0),r(a,void 0,void 0,i),!0},get:A,has:C},g=new Proxy(o,f),h=i=>{let{name:a}=i;if(!a)return;let l=b(i);if(a.endsWith("[]")){let c=v(i,this.arrayCache);if(c===-1)return;a=`${a.slice(0,-2)}[${c}]`}g[`${O}${a}`]={value:l,node:i}};function V(){e.querySelectorAll("[name]").forEach(h)}return this.arrayCache=$(e),V(),e.addEventListener(n,i=>{h(i.target)}),e.addEventListener("reset",()=>{setTimeout(V,0)}),new MutationObserver(i=>{let a=[],l=[];i.forEach(({addedNodes:c,removedNodes:s,type:u,target:d})=>{u==="attributes"&&h(d),s.forEach(m=>N(m,a)),c.forEach(m=>N(m,l))}),a.forEach(c=>{let{name:s}=c;if(s.endsWith("[]")){let u=v(c,this.arrayCache);if(u===-1)return;let d=this.arrayCache[s];d.splice(u,1),d.length===0?s=s.slice(0,-2):s=`${s.slice(0,-2)}[${u}]`}delete g[s]}),this.arrayCache=$(e),l.forEach(c=>{h(c)})}).observe(e,{childList:!0,subtree:!0,attributes:!0,attributeFilter:["value"]}),g}module.exports=F;

if(__exports != exports)module.exports = exports;return module.exports}));
