(function(g,f){if(typeof exports=="object"&&typeof module<"u"){module.exports=f()}else if("function"==typeof define && define.amd){define("ScratchForm",f)}else {g["ScratchForm"]=f()}}(typeof globalThis < "u" ? globalThis : typeof self < "u" ? self : this,function(){var exports={};var __exports=exports;var module={exports};
"use strict";var v=Object.defineProperty;var O=Object.getOwnPropertyDescriptor;var S=Object.getOwnPropertyNames;var P=Object.prototype.hasOwnProperty;var T=(e,t,n,r)=>{if(t&&typeof t=="object"||typeof t=="function")for(let a of S(t))!P.call(e,a)&&a!==n&&v(e,a,{get:()=>t[a],enumerable:!(r=O(t,a))||r.enumerable});return e};var V=e=>T(v({},"__esModule",{value:!0}),e);var H={};module.exports=V(H);function C(e){let{type:t,value:n}=e;if(t==="checkbox"||t==="radio")return e.checked?n:void 0;if(t==="number"||t==="range")return parseFloat(n);if(t==="file"){let{files:r}=e;return r?.length?r:null}return n}function I(e,t){if(e.type==="checkbox"||e.type==="radio"){e.checked=!!t;return}e.value=String(t)}function E(e,t){e.hasAttribute("name")&&t.push(e),t.splice(t.length,0,...Array.from(e.querySelectorAll("[name]")))}function N(e){let t={};return e.querySelectorAll('[name$="[]"]').forEach(n=>{let r=t[n.getAttribute("name")];r||(r=[],t[n.getAttribute("name")]=r),r.push(n)}),t}function F(e,t){let n=e.getAttribute("name"),r=t[n].findIndex(a=>a===e);return r===-1&&console.error(`Could not find index for node: ${e.outerHTML}`),r}function p(e){let t=e,n=[],r=e.indexOf("[");return r!==-1&&(t=e.slice(0,r),n=e.slice(r+1,-1).split("][")),n.unshift(t),n}function g(e){let[t,...n]=e;return n.length?`${t}[${n.join("][")}]`:t}function y(e,t,n,r=!1){let[a,...h]=p(t);if(h.length>0){e[a]||(/^[0-9]+$/.test(h[0])?e[a]=[]:e[a]={}),y(e[a],g(h),n,r);return}if(r){if(Array.isArray(e)){let d=parseInt(a,10);if(Number.isNaN(d))return;e.splice(d,1);return}delete e[a];return}e[a]=n}function b(e,t){let[n,...r]=p(t);return r.length>0?e[n]?b(e[n],g(r)):void 0:e[n]}function A(e,t){let[n,...r]=p(t);return r.length>0?e[n]?A(e[n],g(r)):!1:n in e}var L="_sf_";function $(e,t={}){let{onChange:n,event:r="input"}=t,a={},h={set(c,u,s){let i=u.toString(),o=s,l;return i.startsWith(L)?(i=i.slice(L.length),{value:o,node:l}=s):(l=e.querySelector(`[name="${i}"]`)||void 0,l&&I(l,s)),y(c,i,o),n?.(i,o,l,c),!0},deleteProperty(c,u){let s=u.toString();return y(c,s,void 0,!0),n?.(s,void 0,void 0,c),!0},get:b,has:A},d=new Proxy(a,h),f=c=>{let u=c.getAttribute("name");if(!u)return;let s=C(c);if(u.endsWith("[]")){let i=F(c,this.arrayCache);if(i===-1)return;u=`${u.slice(0,-2)}[${i}]`}d[`${L}${u}`]={value:s,node:c}};function k(){e.querySelectorAll("[name]").forEach(f)}return this.arrayCache=N(e),k(),e.addEventListener(r,c=>{f(c.target)}),e.addEventListener("reset",()=>{setTimeout(k,0)}),new MutationObserver(c=>{let u=[],s=[];c.forEach(({addedNodes:i,removedNodes:o,type:l,target:m})=>{l==="attributes"&&f(m),o.forEach(x=>E(x,u)),i.forEach(x=>E(x,s))}),u.forEach(i=>{let o=i.getAttribute("name");if(o){if(o.endsWith("[]")){let l=F(i,this.arrayCache);if(l===-1)return;let m=this.arrayCache[o];m.splice(l,1),m.length===0?o=o.slice(0,-2):o=`${o.slice(0,-2)}[${l}]`}delete d[o]}}),this.arrayCache=N(e),s.forEach(i=>{f(i)})}).observe(e,{childList:!0,subtree:!0,attributes:!0,attributeFilter:["value"]}),d}module.exports=$;

if(__exports != exports)module.exports = exports;return module.exports}));
